create database canteenapp;
use canteenapp;
CREATE TABLE STUDENT(
PRN INT PRIMARY KEY ,
NAME VARCHAR(20) NOT NULL,
EMAIL VARCHAR(50) ,
PHONE_NO VARCHAR(15),
DEPARTMENT VARCHAR(20),
WALLET_BALANCE INT);

CREATE TABLE COUNTER(
COUNTER_ID INT primary KEY ,
NAME VARCHAR(30),
LOCATION VARCHAR(100),
IS_ACTIVE BOOLEAN DEFAULT TRUE,
ACTIVE_ORDERS INT default 0);


CREATE TABLE MENUITEMS(
ITEM_ID INT PRIMARY KEY,
NAME VARCHAR(50),
PRICE DECIMAL(10,2) NOT NULL ,
CATEGORY VARCHAR(20),
DESCRIPTION VARCHAR(50),
AVAILABILITY boolean default true,
PREPARATION_TIME INT,
COUNTER_ID INT,
foreign key (COUNTER_ID) REFERENCES COUNTER(COUNTER_ID)
);

	CREATE TABLE TIME_SLOT(
	SLOT_ID INT PRIMARY KEY,
	START_TIME TIMESTAMP NOT NULL,
	END_TIME TIMESTAMP NOT NULL,
	CURRENT_ORDERS INT DEFAULT 0,
	COUNTER_ID INT,
	FOREIGN KEY (COUNTER_ID) REFERENCES COUNTER(COUNTER_ID),
	CHECK (END_TIME > START_TIME)
	);
    
ALTER TABLE STUDENT 
MODIFY PRN CHAR(10);

CREATE TABLE ORDER_TABLE(
ORDER_ID INT PRIMARY KEY,
PRN CHAR(10),
FOREIGN KEY(PRN) REFERENCES STUDENT(PRN),
COUNTER_ID INT,
FOREIGN KEY(COUNTER_ID) REFERENCES COUNTER(COUNTER_ID),
ORDER_TIME TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
PICKUP_TIME TIMESTAMP,
CHECK (PICKUP_TIME>=ORDER_TIME),
STATUS BOOLEAN DEFAULT FALSE,
PAYMENT_STATUS BOOLEAN DEFAULT FALSE,
TOTAL_AMOUNT DECIMAL(10,2) DEFAULT 0
);

ALTER TABLE MENUITEMS RENAME TO MENU_ITEMS;

CREATE TABLE ORDER_ITEMS(
ORDER_ITEM_ID INT PRIMARY KEY AUTO_INCREMENT,
ITEM_ID INT NOT NULL,
FOREIGN KEY (ITEM_ID) REFERENCES MENU_ITEMS(ITEM_ID),
ORDER_ID INT,
FOREIGN KEY (ORDER_ID) REFERENCES ORDER_TABLE(ORDER_ID),
QUANTITY INT DEFAULT 1,
SUB_TOTAL DECIMAL(10,2)
);

CREATE TABLE PAYMENT(
PAYMENT_ID INT PRIMARY KEY,
ORDER_ID INT,
FOREIGN KEY(ORDER_ID) REFERENCES ORDER_TABLE(ORDER_ID),
TRANSACTION_ID VARCHAR(20),
PAYMENT_METHOD VARCHAR(30),
AMOUNT DECIMAL(10,2),
PAYMENT_TIME TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO STUDENT (PRN, NAME, EMAIL, PHONE_NO, DEPARTMENT, WALLET_BALANCE) 
VALUES ('123B1F057', 'sankashan ', 'random_email@gmail.com', '9699029035', 'IT', 5000);

INSERT INTO COUNTER (COUNTER_ID, NAME, LOCATION, IS_ACTIVE, ACTIVE_ORDERS) 
VALUES (1, 'Main Canteen', 'Building A - Ground Floor', TRUE, 0);
INSERT INTO MENU_ITEMS (ITEM_ID, NAME, PRICE, CATEGORY, DESCRIPTION, AVAILABILITY, PREPARATION_TIME, COUNTER_ID) 
VALUES (101, 'Veg Burger', 50.00, 'Fast Food', 'Delicious veg burger', TRUE, 10, 1);

INSERT INTO TIME_SLOT (SLOT_ID, START_TIME, END_TIME, CURRENT_ORDERS, COUNTER_ID) 
VALUES (1, '2025-03-16 10:00:00', '2025-03-16 12:00:00', 0, 1);

INSERT INTO ORDER_TABLE (ORDER_ID, PRN, COUNTER_ID, ORDER_TIME, PICKUP_TIME, STATUS, PAYMENT_STATUS, TOTAL_AMOUNT) 
VALUES (1001, '123B1F057', 1, CURRENT_TIMESTAMP, TIMESTAMPADD(MINUTE, 15, CURRENT_TIMESTAMP), FALSE, FALSE, 50.00);
INSERT INTO PAYMENT (PAYMENT_ID, ORDER_ID, TRANSACTION_ID, PAYMENT_METHOD, AMOUNT, PAYMENT_TIME) 
VALUES (5001, 1001, 'TXN123456789', 'Credit Card', 50.00, CURRENT_TIMESTAMP);


